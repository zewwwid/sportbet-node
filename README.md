# sportbet-node

# Терминология

**Аккаунт** - пара публичный/приватный ключ способая выступать в качестве автора транзакций (т.е. подписывать их). Дополнительные атрибуты аккаунта (ФИО, Email, Телефон) хранящиеся за пределами блокчейна.

**Федерация** - объединение аккаунтов договорившехся об общих правилах проведения туриниров, рейтиноговой системе и распределении ролей. Данные договоренности происходят за рамками блокчейна. Правила проведения турниров и рейтинговая система задается создателем федерации. А договоренности свзанные с распределением ролей подтверждаются с помощью заявок аккаунтов на вступление в федерацию или изменения своих ролей в ней. Заявки одобряются создателем федерации. Создатель федерации может в одностороннем порядке исключить аккаунт из федерации или изменить его роли. Аккаунт может добровольно покинуть федерацию. Дополнительные атрибуты федерации хранятся за пределами блокчейна.

**Член федерации** - аккаунт состоящий в федерации и обладающий в рамках нее своими ролями, разрядом и рейтингом.

**Роль** - набор прав и обязанностей определяющий какие функции может выполнять аккаунт в рамках федерации/туринира/тренировки.

**Турнир** - конечная серия поединков проводимых между аккаунтами, входящих в одну федерацию и договорившихся (на время проведения турнира) о правилах (в рамках общих правил федерации), с целью повышения личного рейтинга. Договоренность подтверждается добровольной заявкой аккаунта на участи в турнире, в одной из ролей (которую он может исполнять в рамках федерации).
    
**Поединок** - ???

**Тренировка** - конечная серия поединков проводимая между аккаунтами (без учета их членства в федерациях), договорившехся о правилах (ограниченных только возможностями системы), с целью повышения личных навыков (не влияющая на рейтинги в федерациях).

# Цель
Обсепечить "прозрачное" ведение турниров и рейтингов играков за счет автоматического децентрализованного принятия решения о признании участника победителем и присвоения соответсвующего рейтинга.
	
# Функциональность системы

## Формирование федераций

Любой аккаунт (участник сети) может создать собственную федерацию.

Федерация оперделяет правила проведения турниров. Например:
- Мин. кол-во игроков в турнире: 16
- Макс. кол-во игроков в ткрнире: 32
- Мин. кол-во судей в турнире: 3
- Макс. кол-во судей в турнире: 5

Федерация определеяет правила расчета рейтина и присвоения разряда играков. Например:
- Низший разряд: 4 // Высшим всегда считается 0
- Баллов за победу над соперником низшего разряда: 0,5
- Баллов за победу над соперником того же разряда: 1
- Баллов за победу над соперником высшего разряда: 1,5
- Баллов за победу в турнире: 2
- Кол-во баллов для присвоения следующего разряда: 100
  
Любой аккаунт может подать заявку на включение его в федерацию указав при этом свои начальные роли и разрад. Например:
- Игрок: да
- Судья: да
- Арбитр: нет
- Разряд: 2

Создатель федерации имеет право принять или откланить заявку.

Участник федерации имеет право подать заявку на изменение своих ролей.

Создатель федерации имеет право в одностароннем порядке исключить участника из федерации.

Участник имеет право добровольно покинуть федерацию.

### Транзакции
#### Создание федерации
##### Атрибуты отправляемые в сеть:
```
key: publickey; // Публичный ключ федерации (генерируется клиентом)
owner: publickey; // Публичный ключ создателя (владельца) федерации
min_count_players: int; // Мин. кол-во игроков в турнире
max_count_players: int; // Макс. кол-во игроков в турнире
min_count_judges: int; // Мин. кол-во судей в турнире
max_count_judges: int; // Макс. кол-во судей в турнире
lowest_rank: int; // Низший разряд
lower_level_points: double; // Баллов за победу над соперником низшего разряда
same_level_points: double; // Баллов за победу над соперником того же разряда
top_level_points: double; // Баллов за победу над соперником высшего разряда
tournament_points: double; // Баллов за победу в турнире
next_rank_points: double; // Кол-во баллов для присвоения следующего разряда
created_at: timestamp; // Дата создания федераии
```
##### Дополнительне артибуты вне сети:
```
name: string; // Название федерации
...
```
```
Справочник разрадов. Например:
    0 - МС
    1 - КМС
    2 - разряд 1
    ...
```
##### Валидация:
1. unique key (не существует федерации с таким ключем).
2. owner = author (нельзя создать федерацию указав другого участника сети владельцем).
3. Минимальное количество судей нечетное.
4. Максимальное количество судей не четное.
5. Мин. и макс. кол-во участников четное.
6. high_rank < lowest_rank (чем выше разрядь тем его номер меньше).

#### Завка на включение в федерацию
##### Атрибуты отправляемые в сеть:
````
key: publickey; // Публичный ключ заякления (генерируется клиентом)
declarer: publickey; // Публичный ключ заявителя
federation: publickey; // Публичный ключ федерации
player: bool; // Игрок
judge: bool; // Судья
arbiter: bool; // Арбитр
rank: int; // Разряд
created_at: timestamp; // Дата формирования заявления
````
##### Дополнительне артибуты вне сети:
````
description: string // Описание: "Я Иванов ... прошу включить меня в федерацию на основании ... и присвоить рейтинг ..."
...
````
##### Валидация:
1. unique key.
2. Существует federation.
3. rank >= 0 && rank <= lowest_rank
	
#### Заявка на изменение ролей
##### Атрибуты отправляемые в сеть:
```
key: publickey; // Публичный ключ заявления (генерируется клиентом)
declarer: publickey; // Публичный ключ заявителя
federation: publickey; // Публичный ключ федерации
player: bool; // Игрок
judge: bool; // Судья
arbiter: bool; // Арбитр
created_at: timestamp; // Дата формирования заявления
```
##### Дополнительне артибуты вне сети:
```
description: string // Описание: "Я Иванов ... прошу перевести разрешить мне выполнять функции арбитра т.к. я заплатил денег и получил соответствующий разрад как игрок"
...
```
##### Валидация:
1. unique key.
2. Существует federation.
		
#### Подтверждение/отклонение заявок
##### Атрибуты отправляемые в сеть:
```
key: publickey; // Публичный ключ заякления
result: bool; // Принята/откланена
```
##### Валидация:
1. Существует заявка key.
2. Владельцем федерации federation является author транзакции подтверждения.
3. Зявитель declarer еще не состоит в федерации (для заявки на включение)
3. Зявитель declarer состоит в федерации (для заявки на изменение ролей)
		
#### Односторонне исключение из федерации
```
... // TODO
```

#### Добровольный выход из федерации
```
... // TODO
```
	
## Веденеи турниров
### Транзакции
#### Создание турнира
Аккаунт состоящий в федерации и имеющий роль Арбитр может создавать турниры.

##### Атрибуты отправляемые в сеть:
```
key: publickey; // Публичный ключ турнира
arbiter: publickey; // Публичный ключ арбитра турнира
federation: publickey; // Публичный ключ федерации
count_players: int; // Заявленное количество участников
count_judges: int; // Заявленное количество судей
```
##### Дополнительне артибуты вне сети:
```
name: string;
address: string;
date_from: timestamp;
date_to: timestamp;
....
```
##### Валидация:
1. unique key.
2. arbiter = author.
3. author in federation
4. count_players >= min_count_players && count_players <= max_count_players
5. count_judges >= min_count_judges && count_judges <= max_count_judges
			
#### Заявка на турнир
Аккаунты состоящие в федерации и имеющие роль Игрок могут заявлятся на участие в турнире.

Аккаунты состоящие в федерации и имеющие роль Судья могут заявлятся на участие в турнире.

##### Атрибуты отправляемые в сеть:
TODO
##### Дополнительне артибуты вне сети:
TODO
##### Валидация:
TODO


#### Создание игры
TODO




### Проведение поединков
### Подсчет рейтингов игроков
## Ведени тренировок
		
#Роли (права и обязанности):
	**Создаетель федерации**
		- создавать федерацию;
		- отслеживать заявки;
		- принимать в федерацию дугие аккаунты;
		- изменять роли членов федерации;
		- исключать из федерации.
	**Игрок**
		- участовать в турнирах в роли игрока;
		- подтверждать свою готовность к началу поединка;
		- подтверждать завершение подинка (??? спорно).
	**Судья**
		- участовать в турнирах в роли судьи;
		- подтверждать свою готовность к началу поединка;
		- отдавать свой голос за одного из играков;
	**Арбитр**
		- создавать турнир;
		- создавать поединки в турнире;
		- подтверждать свою готовность к началу поединка;
		- отменять поединки;
		- отменять турнир;
		- завршать турнир.
